{"version":3,"sources":["webpack:///../node_modules/@babel/runtime/helpers/getPrototypeOf.js","webpack:///./Reviews/index.js","webpack:///../node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack:///./Reviews/Comments/Comment.js","webpack:///../node_modules/@babel/runtime/helpers/extends.js","webpack:///./Reviews/Stars/index.js","webpack:///./Reviews/Comments/Wrapper.js","webpack:///./Reviews/helpers.js","webpack:///./helpers/fletch.js","webpack:///../node_modules/@babel/runtime/helpers/possibleConstructorReturn.js","webpack:///./Reviews/constants.js","webpack:///./Reviews/Modal/index.js","webpack:///../node_modules/@babel/runtime/helpers/createClass.js","webpack:///../node_modules/@babel/runtime/helpers/objectWithoutPropertiesLoose.js","webpack:///./Reviews/Form/Success.js","webpack:///../node_modules/@babel/runtime/helpers/iterableToArray.js","webpack:///../node_modules/@babel/runtime/helpers/objectWithoutProperties.js","webpack:///../node_modules/@babel/runtime/helpers/classCallCheck.js","webpack:///../node_modules/@babel/runtime/helpers/assertThisInitialized.js","webpack:///./Reviews/Ratings/CTA.js","webpack:///../node_modules/@babel/runtime/helpers/setPrototypeOf.js","webpack:///./Reviews/Form/index.js","webpack:///../node_modules/@babel/runtime/helpers/typeof.js","webpack:///../node_modules/@babel/runtime/helpers/inherits.js","webpack:///../node_modules/@babel/runtime/helpers/asyncToGenerator.js","webpack:///./Reviews/Ratings/Base.js","webpack:///../node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack:///./helpers/state.js","webpack:///./i18n.js","webpack:///../node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack:///../src/index.js","webpack:///../src/util.js","webpack:///../src/PureComponent.js","webpack:///../src/suspense.js","webpack:///../src/suspense-list.js","webpack:///../src/portals.js","webpack:///../src/render.js","webpack:///../src/forwardRef.js"],"names":["_getPrototypeOf","o","module","exports","Object","setPrototypeOf","getPrototypeOf","__proto__","__esModule","REVIEWS_PER_PAGE","avgRatings","newest","old","count","App","props","cards","Array","from","document","querySelectorAll","map","el","id","getAttribute","rating","Number","total","reviews","title","closest","querySelector","textContent","totalsByCardId","reduce","obj","ratingByCardId","state","reviewsByCardId","getInitialReviews","bind","getCard","addExistingReview","updateExistingReview","addNewReview","this","requests","auth","get","then","data","headers","Promise","all","forEach","avg","length","setState","rest","creation","review","edited_by_user","newTotal","updatedReview","updatedReviews","parseFloat","card","createPortal","onAdd","onUpdate","items","onLoad","Component","window","MV_CREATE_SETTINGS","__REVIEWS_DIV__","root","parent","parentNode","wrap","createElement","elToGetStylesFrom","styleRef","getComputedStyle","style","className","insertBefore","base","comments","render","dataset","hasLoaded","MV_REVIEWS_INIT","arrayWithoutHoles","require","iterableToArray","unsupportedIterableToArray","nonIterableSpread","arr","LOADING","LOADED","OPEN","CLOSED","CLASS","SingleComments","initialData","getInitialState","page","localRating","status","modal","getComments","handleOpen","handleStarClick","handleUpdateRatings","e","preventDefault","class","i18n","onClick","toFixed","href","one","some","comment","author_name","Date","created","toLocaleString","clickable","review_title","review_content","onClose","onSubmit","_extends","assign","target","i","arguments","source","key","prototype","hasOwnProperty","call","apply","getRatingClass","safeRating","Math","round","toString","replace","Stars","globalRating","xmlns","viewBox","d","transform","defaultProps","ORIGINAL","REVIEWS","CommentsWrapper","activeTab","tabs","label","supportStandaloneForm","AGGRESSIVE_CTA","marginTop","paddingTop","firstElementChild","_","prevState","display","floor","now","initial","cursor","item","defaults","send","post","put","uri","config","url","fetchConfig","Headers","append","fetch","res","json","ok","response","reject","catch","err","method","params","body","JSON","stringify","API_ROOT","submit","console","warn","prevReview","handshake","ceil","random","setLocalState","store","_typeof","assertThisInitialized","self","TypeError","SETTINGS","PROMPT_THRESHOLD","__PROMPT_THRESHOLD__","AUTOSUBMIT_THESHOLD","min","__SUBMIT_THRESHOLD__","__API_ROOT__","PENDING","ERROR","DELAY","INITIAL","SUBMITTING","SUBMITTED","__OPTIONS__","reviews_ctas","Modal","handleClick","handleEsc","classList","add","addEventListener","remove","removeEventListener","which","children","_defineProperties","descriptor","enumerable","configurable","writable","defineProperty","Constructor","protoProps","staticProps","excluded","sourceKeys","keys","indexOf","width","height","fill","xlinkHref","mask","iter","Symbol","iterator","objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","instance","ReferenceError","CTA","_setPrototypeOf","p","Input","name","TextArea","Label","Button","InputGroup","error","errors","Error","details","Form","reviewId","author_email","isAboveThreshold","formIsValid","handleChange","handleSubmitButtonClick","handleStarSubmit","checkValidity","getFormValidationStatus","setTimeout","code","message","value","trim","for","placeholder","onInput","required","type","disabled","fromInitial","constructor","subClass","superClass","create","asyncGeneratorStep","gen","resolve","_next","_throw","arg","info","done","fn","args","undefined","Ratings","renderInner","renderModal","cardWrap","insertAfter","appendChild","nextSibling","submitData","cardThemeSupportsTopLevelCTA","arrayLikeToArray","isArray","KEY","getLocalState","parse","localStorage","getItem","ratings","updatedRatings","setItem","values","find","pattern","__","str","string","result","MV_CREATE_I18N","toUpperCase","match","glue","every","s","replacement","split","child","index","getHookState","options","currentComponent","currentHook","hooks","push","useState","initialState","useReducer","invokeOrReturn","reducer","init","hookState","currentIndex","_reducer","nextValue","action","useEffect","callback","argsChanged","flushAfterPaintEffects","component","afterPaintEffects","sort","a","b","pop","invokeCleanup","invokeEffect","hook","comp","cleanup","oldArgs","newArgs","f","shallowDiffers","PureComponent","Suspense","_suspenders","suspended","vnode","SuspenseList","_map","ContextProvider","getChildContext","context","Portal","_this","container","_container","componentWillUnmount","_temp","nodeType","childNodes","before","removeChild","splice","empty","isPropagationStopped","cancelBubble","isDefaultPrevented","defaultPrevented","prevRaf","oldBeforeDiff","oldBeforeRender","oldAfterDiff","diffed","oldCommit","oldBeforeUnmount","unmount","c","requestAnimationFrame","raf","clearTimeout","timeout","HAS_RAF","cancelAnimationFrame","commitQueue","filter","cb","hasErrored","isPureReactComponent","shouldComponentUpdate","oldDiffHook","ref","oldCatchError","newVNode","oldVNode","oldUnmount","promise","suspendingVNode","suspendingComponent","resolved","onResolved","onSuspensionComplete","suspendedVNode","removeOriginal","detachedParent","originalParent","forceUpdate","wasHydrating","detachedComponent","detachedClone","parentDom","effect","fallback","Fragment","list","node","delete","revealOrder","size","delegated","u","wrappedUnsuspend","unsuspend","Map","toChildArray","reverse","set","componentDidUpdate","componentDidMount","REACT_ELEMENT_TYPE","CAMEL_PROPS","IS_DOM","onChangeInputType","test","isReactComponent","v","oldEventHook","event","persist","nativeEvent","classNameDescriptor","oldVNodeHook","normalizedProps","nonCustomElement","toLowerCase","multiple","selected","defaultValue","$$typeof"],"mappings":"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","file":"mv-reviews.chunk.5364a.js","sourcesContent":["function _getPrototypeOf(o) {\n  module.exports = _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  return _getPrototypeOf(o);\n}\n\nmodule.exports = _getPrototypeOf, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import { render, Component } from 'preact'\nimport { createPortal } from 'preact/compat'\nimport Comment from './Comments/Comment'\nimport CommentsWrapper from './Comments/Wrapper'\nimport ReviewForm from './Form'\nimport Ratings from './Ratings/Base'\nimport Modal from './Modal'\nimport Stars from './Stars'\nimport { auth } from './helpers'\n\nconst REVIEWS_PER_PAGE = 3\n\nexport {\n  Comment,\n  CommentsWrapper,\n  ReviewForm,\n  Ratings,\n  Modal,\n  Stars,\n  REVIEWS_PER_PAGE,\n}\n\n/**\n * Given a set of ratings, average in a new arting\n * @param {number} newest  Incoming rating\n * @param {number} old     Previous agg. rating\n * @param {number} count   New rating count\n */\nconst avgRatings = (newest, old, count) => ((old * (count - 1)) + newest) / count\n\n/**\n * Given a set of elements with \"mv-create-rating\" attribute, generate an initial array\n * of card data.\n */\nconst getCards = () => Array.from(document.querySelectorAll('[data-mv-create-rating]'))\n  .map((el) => {\n    const id = el.getAttribute('data-mv-create-id')\n    const rating = Number(el.getAttribute('data-mv-create-rating'))\n    const total = el.getAttribute('data-mv-create-total-ratings')\n\n    return ({\n      id,\n      el,\n      rating,\n      total,\n      reviews: [],\n      // FIXME: Is there a better way of deriving the title from the div?\n      title: el.closest('.mv-create-card').querySelector('.mv-create-title').textContent,\n    })\n  })\n\n  /**\n * Given an element, insert a div beforehand and apply box model of original element to new element.\n * @param  {DOMNode} el Element on which to mount\n * @return {array}      Duple with index 0 being the created element\n *                      and index 1 being the original element\n */\nconst makeCommentsBase = (el) => {\n  const parent = el.parentNode\n  const wrap = document.createElement('DIV')\n\n  // llc comments adds a wrapper div which doesn't have the styles that we need so we'll grab it from a different element\n  const elToGetStylesFrom = el.id === 'llc_comments' ? document.querySelector('.entry-content') : el\n  const styleRef = getComputedStyle(elToGetStylesFrom);\n\n  wrap.style['width'] = styleRef['width']\n  wrap.className = 'mv-reviews-cta-wrap'\n  \n  parent.insertBefore(wrap, el)\n  return [wrap, el]\n}\n\n/**\n * Manages central data store for revivew data.\n * Uses the localized setting for the review prompt and autosubmit threshold.\n */\nclass App extends Component {\n  constructor(props) {\n    super(props)\n\n    // Get original cards and reduce array into key-value pairs\n    // for card ids and review totals/average ratings, respectively.\n    // By keeping these as objects, we make lookups and updates simplier.\n    this.cards = getCards()\n    const totalsByCardId = this.cards.reduce((obj, { id, total }) => ({ ...obj, [id]: total }), {})\n    const ratingByCardId = this.cards.reduce(\n      (obj, { id, rating }) => ({ ...obj, [id]: rating }),\n      {},\n    )\n\n    this.state = {\n      totalsByCardId,\n      ratingByCardId,\n      reviewsByCardId: {}, // We need to fetch these async, so we initializes as an empty object.\n    }\n\n    this.getInitialReviews = this.getInitialReviews.bind(this)\n    this.getCard = this.getCard.bind(this)\n    this.addExistingReview = this.addExistingReview.bind(this)\n    this.updateExistingReview = this.updateExistingReview.bind(this)\n    this.addNewReview = this.addNewReview.bind(this)\n  }\n\n  componentDidMount() {\n    this.getInitialReviews()\n  }\n\n  /**\n   * Pre-loads three review for reach card\n   */\n  getInitialReviews() {\n    const requests = this.cards.map(({ id }) => {\n      // Get the first three reviews for each card by ID and map to a key-value pair to be flattened\n      const resultAsId = auth.get(\n        `mv-create/v1/reviews?creation=${id}&limit=${REVIEWS_PER_PAGE}`,\n      )\n      // Return a tuple of our data object and response headers\n      .then(({ data, headers }) => ([\n        id,\n        data,\n        headers.get('x-total-items'),\n      ]))\n\n      return resultAsId\n    })\n\n    Promise.all(requests)\n      .then(reviews => {\n        let reviewsByCardId = {}\n        let totalsByCardId = {}\n        let ratingByCardId = {}\n\n        reviews.forEach(([id, reviews, total]) => {\n          reviewsByCardId[id] = reviews\n          totalsByCardId[id] = total\n          ratingByCardId[id] = reviews.reduce((avg, { rating }) => avg + Number(rating), 0) / reviews.length\n        })\n\n        this.setState({ reviewsByCardId, totalsByCardId, ratingByCardId })\n      })\n  }\n\n  /**\n   * Maps card data into data accessed via dictionary\n   * @param  {number} id   Card ID\n   * @params {object} rest Rest of data to display by default\n   */\n  getCard({ id, ...rest }) {\n    const { totalsByCardId, ratingByCardId, reviewsByCardId } = this.state\n    return ({\n      ...rest,\n      id,\n      total: totalsByCardId[id],\n      reviews: reviewsByCardId[id] || [],\n    })\n  }\n\n  /**\n   * Attaches reviews to global state when loaded via pagination\n   * @param  {...any} reviews\n   */\n  addExistingReview(...reviews) {\n    const { creation } = reviews[0]\n    this.setState(state => ({\n      reviewsByCardId: {\n        ...state.reviewsByCardId,\n        [creation]: [...state.reviewsByCardId[creation], ...reviews],\n      },\n    }))\n  }\n\n  /**\n   * When a user leaves a review, add it to the state and update average ratings/totals\n   * @param {number} id       ID of card to attach review to\n   * @param {object} review   Review contents\n   */\n  addNewReview(id, review) {\n    const { creation, rating } = review\n\n    // If review was edited, we want to update it instead\n    if (review.edited_by_user == 1) { // eslint-disable-line\n      return this.updateExistingReview(id, review)\n    }\n\n    const newTotal = Number(this.state.totalsByCardId[creation]) + 1\n\n    return this.setState(state => ({\n      totalsByCardId: {\n        ...state.totalsByCardId,\n        [creation]: newTotal,\n      },\n      ratingByCardId: {\n        ...state.ratingByCardId,\n        [creation]: avgRatings(\n          Number(rating),\n          Number(state.ratingByCardId[creation]),\n          newTotal,\n        ),\n      },\n      reviewsByCardId: {\n        ...state.reviewsByCardId,\n        [creation]: [review, ...state.reviewsByCardId[creation]],\n      },\n    }))\n  }\n\n  /**\n   * When a user updates an existing review, update in state\n   * @param {number} creation        ID of card\n   * @param {object} updatedReview   Updated review contents\n   */\n  updateExistingReview(creation, updatedReview) {\n    const reviewsByCardId = this.state.reviewsByCardId[creation]\n    const updatedReviews = reviewsByCardId.map((review) => {\n      if (review.id == updatedReview.id) { // eslint-disable-line\n        return updatedReview\n      }\n      return review\n    })\n\n    const { rating } = updatedReview\n\n    this.setState(state => ({\n      ratingByCardId: {\n        ...state.ratingByCardId,\n        [creation]: avgRatings(\n          parseFloat(rating),\n          parseFloat(state.ratingByCardId[creation]),\n          state.totalsByCardId[creation],\n        ),\n      },\n      reviewsByCardId: {\n        ...state.reviewsByCardId,\n        [creation]: updatedReviews,\n      },\n    }))\n  }\n\n  render() {\n    const { el } = this.props // eslint-disable-line\n    const cards = this.cards.map(this.getCard)\n\n    return (\n      <div>\n        {/* Map over each card and mount upon the ratings element. */}\n        {cards\n          .map(card => (\n            createPortal(\n              <Ratings\n                {...card}\n                onAdd={this.addNewReview}\n                onUpdate={this.updateExistingReview}\n              />, \n              card.el\n            )\n\n          ))}\n\n        {/* If public reviews are enabled, mount the comments wrapper */}\n        {el && (\n          <CommentsWrapper\n            el={el}\n            items={cards}\n            onAdd={this.addNewReview}\n            onUpdate={this.updateExistingReview}\n            onLoad={this.addExistingReview}\n          />\n        )}\n      </div>\n    )\n  }\n}\n\nexport default () => {\n  const id = window.MV_CREATE_SETTINGS.__REVIEWS_DIV__ // eslint-disable-line\n\n  const root = id && document.querySelector(id)\n  // If this isn't defined, we can't run our application.\n  // (This would only NOT be defined for content types that don't support reviews.)\n  const apiRoot = document.querySelector('[data-mv-rest-url]')\n  if (!apiRoot) return\n\n  // If we have an id to mount on, we need to provide `el` as a prop to our app\n  if (root) {\n    const [base, comments] = makeCommentsBase(root)\n    render(<App el={comments} />, base)\n  } else {\n    // This is a bit weird. If we don't have a root to mount the \"reviews\" app,\n    // we still need we need a DOM node in order to mount the Preact application\n    // that for each \"review.\" The app works by rendering a portal into each\n    // card while centralizing the application logic in one place, so that *when*\n    // there is a root for the \"reviews\" app, it can know about the cards on the\n    // page for things like updating when someone leaves a review, e.g.\n    // Sooooooo that's what this div is used for – TLDR; we need any random div\n    // to mount a single Preact app on and the Preact app doesn't actually render\n    // anything in that div.\n    // https://github.com/developit/preact-portal\n    const base = document.createElement('div')\n    if (!base || base.dataset.hasLoaded) {\n      return\n    }\n    base.dataset.hasLoaded = true\n    render(<App />, base)\n  }\n\n  window.MV_REVIEWS_INIT = true\n}\n","var arrayWithoutHoles = require(\"./arrayWithoutHoles.js\");\n\nvar iterableToArray = require(\"./iterableToArray.js\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread.js\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import { Component } from 'preact'\nimport { Stars, ReviewForm, Modal } from '../'\nimport i18n from '../../i18n'\nimport { getInitialState } from '../../helpers/state'\nimport { auth } from '../helpers'\n\nconst LIMIT = 3\nconst LOADING = 'loading'\nconst LOADED = 'loaded'\nconst OPEN = 'open'\nconst CLOSED = 'closed'\nconst CLASS = 'mv-comments'\n\n/**\n * Forces an array of objects to be unique based on \"id\" key\n */\nconst unique = arr => arr.reduce((all, one) => {\n  if (all.some(({ id }) => one.id == id)) { // eslint-disable-line\n    return all\n  }\n  return [...all, one]\n}, [])\n\nclass SingleComments extends Component {\n  constructor(props) {\n    super(props)\n\n    // Derive initial data used by form from local storage\n    this.initialData = getInitialState(props.id)\n\n    this.state = {\n      // Default to page 2 since we're preloading data\n      page: 2,\n      localRating: null,\n      status: LOADED, // loading, loaded\n      modal: CLOSED, // open\n    }\n\n    this.getComments = this.getComments.bind(this)\n    this.handleOpen = this.handleOpen.bind(this)\n    this.handleStarClick = this.handleStarClick.bind(this)\n    this.handleUpdateRatings = this.handleUpdateRatings.bind(this)\n  }\n\n  /**\n   * Fetches the next page of comments\n   */\n  async getComments() {\n    const { page } = this.state\n\n    this.setState({ status: LOADING })\n\n    // Get data\n    const { data } = await auth.get(\n      `mv-create/v1/reviews?creation=${this.props.data.id}&page=${page}&limit=${LIMIT}`,\n    )\n\n    // Update data\n    this.setState(state => ({\n      page: state.page + 1,\n      status: LOADED,\n    }))\n\n    // Trigger onload callback\n    this.props.onLoad(...data)\n  }\n\n  /**\n   * Opens form modal\n   * @param {*} e\n   */\n  handleOpen(e) {\n    e.preventDefault()\n    this.setState({ modal: OPEN })\n  }\n\n  /**\n   * Open model and update local rating when a star is clicked\n   * @param {number} localRating\n   */\n  handleStarClick(localRating) {\n    this.setState({\n      localRating,\n      modal: OPEN,\n    })\n  }\n\n  /**\n   * Callback after form submission. We close the modal and update ratings.\n   * @param {number} rating    New rating\n   * @param {object} previous  Locally-cached rating\n   */\n  handleUpdateRatings(review) {\n    this.setState({ modal: CLOSED })\n    if (this.initialData) {\n      const { id, onUpdate } = this.props\n      onUpdate(id, review)\n    } else {\n      const { id, onAdd } = this.props\n      onAdd(id, review)\n    }\n  }\n\n  render() {\n    const { data } = this.props\n    const { status, modal, localRating } = this.state\n\n    if (data.reviews.length === 0) {\n      return null\n    }\n\n    return (\n      <div class={`${CLASS}-card`}>\n\n        <header class={`${CLASS}-card-header`}>\n\n          <h2 class={`${CLASS}-card-heading`}>\n            {data.total > 1 ? i18n('X_REVIEWS_FOR')(data.total, data.title) : i18n('X_REVIEW_FOR')(data.total, data.title)}\n          </h2>\n\n          <div class={`${CLASS}-card-stars`}>\n            <Stars rating={data.rating} onClick={this.handleStarClick} />\n\n            {i18n('NUM_STARS')(parseFloat(data.rating).toFixed(1))}\n\n            <div class={`${CLASS}-card-stars-divider`} />\n\n            <a href=\"#\" onClick={this.handleOpen}>\n              {i18n('LEAVE_REVIEW')}\n            </a>\n          </div>\n\n        </header>\n\n        {unique(data.reviews)\n          .map(comment => (\n            <div class={`${CLASS}-review`}>\n              <div class={`${CLASS}-review-author`}>\n                {comment.author_name || <span class={`${CLASS}-placeholder`}>{i18n('ANONYMOUS_USER')}</span>}\n              </div>\n              <div class={`${CLASS}-review-date`}>\n                <time>\n                  {new Date(comment.created * 1000).toLocaleString()}\n                </time>\n              </div>\n              <div class={`${CLASS}-review-stars`}>\n                <Stars rating={comment.rating} clickable={false} />\n                {comment.review_title && <h3>{comment.review_title}</h3>}\n              </div>\n              {comment.review_content && (\n                <div>{comment.review_content}</div>\n              )}\n            </div>\n          ))}\n\n        <footer class={`${CLASS}-loadmore`}>\n          {data.reviews.length < data.total && (\n            <button onClick={this.getComments}>\n              {status === LOADING ? i18n('LOADING') : i18n('VIEW_MORE')}\n            </button>\n          )}\n        </footer>\n\n        {modal === OPEN && (\n          <Modal onClose={() => this.setState({ modal: CLOSED })}>\n            <ReviewForm\n              id={data.id}\n              rating={localRating}\n              onSubmit={this.handleUpdateRatings}\n            />\n          </Modal>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default SingleComments\n","function _extends() {\n  module.exports = _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  return _extends.apply(this, arguments);\n}\n\nmodule.exports = _extends, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import './Stars.scss'\n\n/**\n * Given a string or number value, return a string of the form x.5 or x\n * @param  {string|number} rating \n * @return {string}\n */\nconst getRatingClass = (rating) => {\n  if (!rating) {\n    return null\n  }\n  const safeRating = parseFloat(rating)\n  const roundedToPoint5 = (Math.round(safeRating * 2) / 2).toFixed(1)\n  return roundedToPoint5.toString()\n    .replace('.0', '')\n    .replace('.', '-')\n}\n\nconst Stars = ({\n  className,\n  rating,\n  globalRating,\n  onClick,\n  clickable = onClick,\n}) => (\n  <div class={`mv-reviews-stars ${className}`}>\n    <div class={`mv-stars mv-star-ratings mv-rating-${getRatingClass(globalRating)} mv-rating-user-${getRatingClass(rating)}`}>\n      <svg class=\"star-ratings\" data-name=\"Star Ratings\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"-568 -176 76 11.4\" >\n        {clickable &&\n          <path onClick={() => onClick(5)} data-name=\"Hover Area 5 Stars\" class=\"star-hover-area\" d=\"M-2,0,12,0,12,12,-2,12Z\" transform=\"translate(-504 -176)\" />\n        }\n        <path data-name=\"5 Stars\" class=\"star rating-5\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-504 -176)\" />\n        <path data-name=\"4.5 Stars\" class=\"star rating-4-5 rating-5\" d=\"M6,0,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-504 -176)\" />\n        {clickable &&\n          <path onClick={() => onClick(5)} data-name=\"Clickable 5 Stars\" class=\"star-hover\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-504 -176)\" />\n        }\n        {clickable &&\n          <path onClick={() => onClick(4)} data-name=\"Hover Area 4 Stars\" class=\"star-hover-area\" d=\"M-2,0,14,0,14,12,-2,12Z\" transform=\"translate(-520 -176)\" />\n        }\n        <path data-name=\"4 Stars\" class=\"star rating-4 rating-4-5 rating-5\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-520 -176)\" />\n        <path data-name=\"3.5 Stars\" class=\"star rating-3-5 rating-4 rating-4-5 rating-5\" d=\"M6,0,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-520 -176)\" />\n        {clickable &&\n          <path onClick={() => onClick(4)} data-name=\"Clickable 4 Stars\" class=\"star-hover\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-520 -176)\" />\n        }\n        {clickable &&\n          <path onClick={() => onClick(3)} data-name=\"Hover Area 3 Stars\" class=\"star-hover-area\" d=\"M-2,0,14,0,14,12,-2,12Z\" transform=\"translate(-536 -176)\" />\n        }\n        <path data-name=\"3 Stars\" class=\"star rating-3 rating-3-5 rating-4 rating-4-5 rating-5\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-536 -176)\" />\n        <path data-name=\"2.5 Stars\" data-star=\"2-5\" class=\"star rating-2-5 rating-3 rating-3-5 rating-4 rating-4-5 rating-5\" d=\"M6,0,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-536 -176)\" />\n        {clickable &&\n          <path onClick={() => onClick(3)} data-name=\"Clickable 3 Stars\" class=\"star-hover\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-536 -176)\" />\n        }\n        {clickable &&\n          <path onClick={() => onClick(2)} data-name=\"Hover Area 2 Stars\" class=\"star-hover-area\" d=\"M-2,0,14,0,14,12,-2,12Z\" transform=\"translate(-552 -176)\" />\n        }\n        <path data-name=\"2 Stars\" class=\"star rating-2 rating-2-5 rating-3 rating-3-5 rating-4 rating-4-5 rating-5\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-552 -176)\" />\n        <path data-name=\"1.5 Stars\" class=\"star rating-1-5 rating-2 rating-2-5 rating-3 rating-3-5 rating-4 rating-4-5 rating-5\" d=\"M6,0,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-552 -176)\" />\n        {clickable &&\n          <path onClick={() => onClick(2)} data-name=\"2 Stars\" class=\"star-hover\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-552 -176)\" />\n        }\n        {clickable &&\n          <path onClick={() => onClick(1)} data-name=\"Hover Area 1 Star\" class=\"star-hover-area\" d=\"M0,0,14,0,14,12,0,12Z\" transform=\"translate(-568 -176)\" />\n        }\n        <path data-name=\"1 Star\" class=\"star rating-1 rating-1-5 rating-2 rating-2-5 rating-3 rating-3-5 rating-4 rating-4-5 rating-5\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-568 -176)\" />\n        {clickable &&\n          <path onClick={() => onClick(1)} data-name=\"Clickable 1 Star\" class=\"star-hover star rating-1 rating-1-5 rating-2 rating-2-5 rating-3 rating-3-5 rating-4 rating-4-5 rating-5\" d=\"M6,0,7.875,3.75,12,4.35,9,7.275,9.675,11.4,6,9.45,2.325,11.4,3,7.275,0,4.35l4.125-.6Z\" transform=\"translate(-568 -176)\" />\n        }\n      </svg>\n    </div>\n  </div>\n)\n\nStars.defaultProps = {\n  className: '',\n  rating: 'na',\n  globalRating: 'na',\n  onClick: () => null,\n}\n\nexport default Stars\n","import { Component } from 'preact'\nimport SingleComments from './Comment'\nimport i18n from '../../i18n'\nimport { getInitialState } from '../../helpers/state'\nimport { ReviewForm, Modal } from '../'\nimport {\n  OPEN,\n  CLOSED,\n  AGGRESSIVE_CTA\n} from '../constants'\nimport './Comments.scss'\n\nconst ORIGINAL = 'ORIGINAL'\nconst REVIEWS = 'REVIEWS'\n\nclass CommentsWrapper extends Component { // eslint-disable-line\n  constructor(props) {\n    super(props)\n\n    this.initialData = getInitialState(props.items[0].id)\n\n    this.state = {\n      activeTab: ORIGINAL,\n      tabs: [\n        { label: i18n('Comments'), id: ORIGINAL },\n        { label: i18n('Reviews'), id: REVIEWS },\n      ],\n      localRating: this.initialData ? this.initialData.rating : null,\n      status: CLOSED,\n    }\n    this.handleUpdateRatings = this.handleUpdateRatings.bind(this)\n\n    // We shoud only support the standalone form\n    // if the comments wrapper has exactly one card,\n    // the aggressive CTA setting is enabled, and\n    // if the user has _not_ left a rating for this\n    // card already.\n    this.supportStandaloneForm =\n      AGGRESSIVE_CTA &&\n      props.items.length === 1 &&\n      !getInitialState(props.items[0].id)\n  }\n\n  componentDidMount() {\n    const { el } = this.props\n    el.style.marginTop = 0\n    el.style.paddingTop = 0\n\n    // This should always exist unless someone put in a bad selector\n    if(el.firstElementChild) {\n      el.firstElementChild.style.marginTop = 0\n      el.firstElementChild.style.paddingTop = 0\n    }\n  }\n\n  /**\n   * When the component updates its tab, toggle visibility of original mounted element.\n   */\n  componentDidUpdate(_, prevState) {\n    const { el } = this.props\n    const { activeTab } = this.state\n    if (prevState.activeTab === activeTab) {\n      return\n    }\n    const shouldDisplay = activeTab === ORIGINAL\n    el.style.display = shouldDisplay ? 'block' : 'none'\n  }\n\n    /**\n   * Callback after form submission. We close the modal and update ratings.\n   * @param {number} rating    New rating\n   * @param {object} previous  Locally-cached rating\n   */\n  handleUpdateRatings(review) {\n    this.setState({ status: CLOSED })\n    if (this.initialData) {\n      const { id, onUpdate } = this.props\n      onUpdate(id, review)\n    } else {\n      const { id, onAdd } = this.props\n      onAdd(id, {\n        ...review,\n        // Mimics the timestamp that would be created via the PHP backend\n        created: Math.floor(Date.now() / 1000)\n      })\n    }\n  }\n\n  render() {\n    const { items } = this.props\n    const {\n      activeTab,\n      tabs,\n      status,\n      localRating,\n    } = this.state\n\n    return (\n      <div class=\"mv-comments-wrap\">\n        {!this.supportStandaloneForm && (\n          <h2>{i18n('COMMENTS_AND_REVIEWS')}</h2>\n        )}\n\n        {this.supportStandaloneForm && (\n          <div class=\"mv-comments-standalone-form\">\n            <div class=\"mv-comments-standalone-form-left\">\n              <h2>{i18n('COMMENTS_AND_REVIEWS')}</h2>\n              <h3>\n                {i18n('DID_YOU_MAKE_THIS')}\n              </h3>\n            </div>\n\n            <div class=\"mv-comments-standalone-form-right\">\n              <ReviewForm\n                id={this.props.items[0].id}\n                initial={this.initialData}\n                rating={0}\n                onSubmit={this.handleUpdateRatings}\n              />\n            </div>\n          </div>\n        )}\n\n        <nav class=\"mv-comments-nav\">\n          <ul>\n            {tabs.map(({ label, id }) => (\n              <li\n              key={id}\n              onClick={() => this.setState({ activeTab: id })}\n              class={id === activeTab ? 'mv-active' : ''}\n              >\n                {label}\n              </li>\n            ))}\n            {!this.supportStandaloneForm && (\n              <li\n                class=\"mv-create-button mv-create-review-button\"\n                onClick={() => {\n                  this.setState({ status: OPEN })\n                }}\n                style={{ cursor: 'pointer' }}\n              >\n                Write a review\n              </li>\n            )}\n          </ul>\n        </nav>\n\n        {status === OPEN && (\n          <Modal onClose={() => this.setState({ status: CLOSED })}>\n            <ReviewForm\n              id={this.props.items[0].id}\n              initial={this.initialData}\n              rating={localRating}\n              onSubmit={this.handleUpdateRatings}\n            />\n          </Modal>\n        )}\n\n        {activeTab === REVIEWS && (\n          items.map(item => (\n            <SingleComments\n              id={item.id}\n              onAdd={this.props.onAdd}\n              onUpdate={this.props.onUpdate}\n              onLoad={this.props.onLoad}\n              key={item.id}\n              data={item}\n            />\n          ))\n        )}\n\n      </div>\n    )\n  }\n}\n\nCommentsWrapper.defaultProps = {\n  items: [],\n}\n\nexport default CommentsWrapper\n","import { setLocalState, getInitialState } from \"../helpers/state\"\nimport Fletch from '../helpers/fletch'\nimport { API_ROOT } from './constants'\n\nexport const auth = new Fletch({ root: API_ROOT })\n\nconst store = ({ data }) => setLocalState({\n  [data.creation]: data\n})\n\nexport const submit = async (data) => {\n  try {\n    // If we don't have correct data, warn\n    if(!data.creation) console.warn('No creation provided')\n    if(!data.rating) console.warn('No rating provided')\n\n    // Get local review data based on creation\n    const prevReview = getInitialState(data.creation)\n\n    // Add random number for handshake if we don't have one\n    if (!prevReview?.handshake) data.handshake = Math.ceil(Math.random()*1000000)\n\n    // If a user has left a local review, update it based on ID\n    // with user_edited set to true\n    const res = prevReview\n      // Update previous reviews based on ID, and mark as edited\n      ? await auth.post(`mv-create/v1/reviews/${prevReview.id}`, { ...data, edited_by_user: 1 })\n      // Create new review if previous doesn't exist\n      : await auth.post(`mv-create/v1/reviews`, data)\n\n    store(res)\n    return res\n  } catch(err) {\n    return err\n  }\n}\n","const l = (d) => {\n  console.log(d)\n  return d\n}\n\nclass Fletch {\n  constructor(props) {\n    this.defaults = {}\n    if (props.root) {\n      this.defaults.root = props.root\n    }\n    this.send = this.send.bind(this)\n    this.post = this.post.bind(this)\n    this.get = this.get.bind(this)\n    this.put = this.put.bind(this)\n  }\n\n  send(uri, config) {\n    let url = uri\n    if (this.defaults && this.defaults.root) {\n      url = `${this.defaults.root}${uri}`\n    }\n    const fetchConfig = config\n    if (!fetchConfig.headers) {\n      const headers = new Headers()\n      headers.append('Content-Type', 'application/json')\n      headers.append('Accept', 'application/json')\n      fetchConfig.headers = headers\n    }\n\n    return fetch(url, fetchConfig)\n      .then(res => res.json().then(data => ({\n        data,\n        headers: res.headers,\n        ok: res.ok,\n      })))\n      .then((response) => {\n        if (!response.ok) {\n          return Promise.reject(response)\n        }\n        return response\n      })\n      .catch(err => Promise.reject(err))\n  }\n\n  get(uri, params = '') {\n    const config = {\n      method: 'GET',\n    }\n    return this.send(uri, config)\n  }\n\n  post(uri, params) {\n    const config = {\n      method: 'POST',\n      body: JSON.stringify(params),\n    }\n    return this.send(uri, config)\n  }\n\n  put(uri, params) {\n    const config = {\n      method: 'PUT',\n      body: JSON.stringify(params),\n    }\n\n    return this.send(uri, config)\n  }\n\n  delete(uri, params) {\n    const config = {\n      method: 'DELETE',\n      body: JSON.stringify(params),\n    }\n\n    return this.send(uri, config)\n  }\n}\n\nexport default Fletch\n","var _typeof = require(\"./typeof.js\")[\"default\"];\n\nvar assertThisInitialized = require(\"./assertThisInitialized.js\");\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return assertThisInitialized(self);\n}\n\nmodule.exports = _possibleConstructorReturn, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","const SETTINGS = window.MV_CREATE_SETTINGS\n\n// threshold to force the review prompt to appear\nexport const PROMPT_THRESHOLD = Number(SETTINGS.__PROMPT_THRESHOLD__)\n// rating that’s required where it won’t autosubmit, but a name, email, review and review must be added\nexport const AUTOSUBMIT_THESHOLD = Math.min(Number(SETTINGS.__SUBMIT_THRESHOLD__), PROMPT_THRESHOLD)\nexport const API_ROOT = SETTINGS.__API_ROOT__\nexport const OPEN = 'open'\nexport const CLOSED = 'closed'\nexport const PENDING = 'pending'\nexport const ERROR = 'error'\nexport const DELAY = 2000\nexport const INITIAL = 'init'\nexport const SUBMITTING = 'submitting'\nexport const SUBMITTED = 'submitted'\nexport const AGGRESSIVE_CTA = SETTINGS.__OPTIONS__.reviews_ctas\n","import { Component } from 'preact'\n\nconst ESC = 27\n\nclass Modal extends Component {\n  constructor(props) {\n    super(props)\n    this.body = document.querySelector('body')\n    this.handleClick = this.handleClick.bind(this)\n    this.handleEsc = this.handleEsc.bind(this)\n  }\n\n  componentDidMount() {\n    this.body.classList.add('mv-modal-open')\n    document.addEventListener('keydown', this.handleEsc)\n  }\n\n  componentWillUnmount() {\n    this.body.classList.remove('mv-modal-open')\n    document.removeEventListener('keydown', this.handleEsc)\n  }\n\n  /**\n   * If clicked element isn't a child of the modal inner, close modal.\n   */\n  handleClick(e) {\n    const parent = e.target.closest('.mv-modal-inner')\n    if (!parent) {\n      this.props.onClose()\n    }\n  }\n\n  /**\n   * If escape key is clicked, close modal.\n   */\n  handleEsc(e) {\n    if (e.which === ESC) {\n      this.props.onClose()\n    }\n  }\n\n  render() {\n    return (\n      <div class=\"mv-modal\" onClick={this.handleClick}> {/* eslint-disable-line */}\n        <div class=\"mv-modal-inner\">\n          <button class=\"mv-modal-close\" onClick={this.props.onClose}>\n            <div class=\"mv-modal-sr\">Close</div>\n            &times;\n          </button>\n          {this.props.children}\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Modal\n","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nmodule.exports = _createClass, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutPropertiesLoose, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","export default () => (\n  <svg width=\"33\" height=\"33\"><defs><path id=\"a\" d=\"M0 0h33v33H0z\" /></defs><g fill=\"none\" fill-rule=\"evenodd\"><path d=\"M30 16c0 7.18-5.82 13-13 13S4 23.18 4 16 9.82 3 17 3s13 5.82 13 13\" fill=\"#FFF\" /><g><mask id=\"b\" fill=\"#fff\"><use xlinkHref=\"#a\" /></mask><path d=\"M24.961 12.96L14.487 24.437a2.065 2.065 0 0 1-1.51.672h-.013c-.57 0-1.115-.236-1.504-.652L6.65 19.332A2.063 2.063 0 1 1 9.66 16.51l3.283 3.5 8.972-9.831a2.067 2.067 0 0 1 2.914-.133c.84.768.9 2.072.133 2.914M16.499 0C7.402 0 0 7.402 0 16.5 0 25.598 7.402 33 16.5 33 25.596 33 33 25.598 33 16.5 33 7.402 25.596 0 16.5 0\" fill=\"#04BA4E\" mask=\"url(#b)\" /></g></g></svg>\n)\n","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var objectWithoutPropertiesLoose = require(\"./objectWithoutPropertiesLoose.js\");\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nmodule.exports = _objectWithoutProperties, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nmodule.exports = _assertThisInitialized, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import { Component } from 'preact'\nimport { CLASS } from './Base'\nimport i18n from '../../i18n'\n\nclass CTA extends Component {\n  render() {\n    const { children, onClick } = this.props\n\n    return (\n      <div class={`${CLASS}-cta`}>\n        {children}\n\n        <div class={`${CLASS}-cta-text`}>\n          {i18n('DID_YOU_MAKE_THIS')}\n        </div>\n        <button onClick={onClick}>\n          {i18n('LEAVE_REVIEW')}\n        </button>\n      </div>      \n    )\n  }\n}\n\nexport default CTA","function _setPrototypeOf(o, p) {\n  module.exports = _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;\n  return _setPrototypeOf(o, p);\n}\n\nmodule.exports = _setPrototypeOf, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/* eslint camelcase: 0 */\nimport { Component } from 'preact'\nimport { Stars } from '../'\nimport i18n from '../../i18n'\nimport './Form.scss'\nimport { getInitialState } from '../../helpers/state'\nimport Success from './Success'\nimport { submit } from '../helpers';\nimport {\n  DELAY,\n  INITIAL,\n  ERROR,\n  SUBMITTING,\n  SUBMITTED,\n  PROMPT_THRESHOLD\n} from '../constants'\n\nconst CLASS = 'mv-review-form'\n\nconst Input = props => <input {...props} id={props.name} /> // eslint-disable-line\nconst TextArea = props => <textarea {...props} id={props.name} /> // eslint-disable-line\nconst Label = ({ children, ...props }) => <label {...props}>{children}</label> // eslint-disable-line\nconst Button = ({ children, ...props }) => <button {...props}>{children}</button> // eslint-disable-line\n\nconst InputGroup = ({ error, errors, children }) => (\n  <div class={error && errors.some(err => err === error.title) ? 'HasError' : 'NoError'}>\n    {children}\n  </div>\n)\n\nconst Error = ({ error, title }) => (error && error.title === title ? <div>{error.details}</div> : null)\n\nclass Form extends Component {\n  constructor(props) {\n    super(props)\n\n    this.initialData = getInitialState(props.id) || {}\n\n    this.state = {\n      reviewId: this.initialData.id,\n      data: {\n        creation: props.id,\n        author_name: '',\n        author_email: '',\n        review_title: '',\n        review_content: '',\n        ...this.initialData,\n        rating: props.rating,\n      },\n      isAboveThreshold: Number(props.rating) >= PROMPT_THRESHOLD,\n      status: INITIAL,\n      error: null,\n      formIsValid: false,\n    }\n\n    this.handleStarClick = this.handleStarClick.bind(this)\n    this.handleChange = this.handleChange.bind(this)\n    this.handleSubmitButtonClick = this.handleSubmitButtonClick.bind(this)\n    this.handleStarSubmit = this.handleStarSubmit.bind(this)\n  }\n\n  /**\n   * Hanldes form submission on button click.\n   */\n  async handleSubmitButtonClick(e) {\n    e.preventDefault()\n    e.target.checkValidity()\n\n    const { data} = this.state\n    const formInvalid = this.getFormValidationStatus()\n\n    if (formInvalid) {\n      this.setState({ status: ERROR })\n      return\n    }\n\n    // when the form as a whole is submitted, add/update everything in the form to the review entry\n    this.setState({ status: SUBMITTING })\n    const res = await submit(data)\n    try {\n      if (res.ok) {\n        this.setState({ status: SUBMITTED })\n        setTimeout(() => this.props.onSubmit(data), DELAY)\n      } else {\n        const error = res.data?.errors?.[0] \n          || { title: res.data?.code, details: res.data?.message } \n          || { title: 'Unknown Error', details: 'An unexpected error occurred' };\n        this.setState({ status: ERROR, error });\n      }\n    } catch (err) {\n      // handle network or unexpected errors\n      this.setState({ status: ERROR, error: { title: 'Network Error', details: 'Failed to submit the form' } });\n    }\n  }\n\n  /**\n   * Updates rating and triggers partial submission if the rating is above our threshold.\n   */\n  handleStarClick(rating) {\n    const { id } = this.props\n\n    this.setState(state => ({\n      data: { ...state.data, rating },\n      isAboveThreshold: Number(rating) >= PROMPT_THRESHOLD,\n    }), () => {\n      if (this.state.isAboveThreshold) {\n        this.handleStarSubmit(id, rating)\n      }\n    })\n  }\n\n  /**\n   * Handles partial submission of creation ID and star rating\n   */\n  async handleStarSubmit(id, rating) {\n    // when a star above our threshold is clicked, add/update the star rating to the review entry\n    const res = await submit({ creation: id, rating })\n    if(!res.ok) {\n      this.setState({ status: ERROR })\n      return\n    }\n  }\n\n  /**\n   * Updates rating in form.\n   */\n  handleChange({ target }) {\n    const key = target.getAttribute('name')\n    const { value } = target\n    \n    this.setState(state => ({ data: { ...state.data, [key]: value } }))\n  }\n\n  getFormValidationStatus() {\n    const { data } = this.state\n\n    return !data.rating || (!this.state.isAboveThreshold && !(data.author_name.trim() && data.author_email.trim() && data.review_content))\n  }\n\n  render() {\n    const { data, isAboveThreshold, status, error } = this.state\n    const { author_name, author_email, review_title, review_content, rating } = data // eslint-disable-line\n\n    if (status === SUBMITTED) {\n      return (\n        <div>\n          <div class={`${CLASS}-success`}>\n            <Success />\n          </div>\n          {i18n('THANKS_REVIEW')}\n        </div>\n      )\n    }\n\n    return (\n      <form method=\"get\" target=\"_blank\" class={CLASS}\n            onSubmit={this.handleSubmitButtonClick}\n      >\n        <div class={`${CLASS}-stars`}>\n          <Stars onClick={this.handleStarClick} rating={rating} />\n        </div>\n\n        {status === ERROR && (\n          <div>{error.details || 'An unknown error occurred.'}</div>\n        )}\n\n\n        <InputGroup>\n          <Label for=\"review_title\">{i18n('REVIEW_TITLE')}</Label>\n          <Input placeholder={i18n('REVIEW_TITLE')} value={review_title} name=\"review_title\" onInput={this.handleChange} />\n        </InputGroup>\n        <InputGroup error={error} errors={['Message is Required']}>\n          <Label for=\"review_content\">{i18n('REVIEW_CONTENT')}{(rating != 0 && !isAboveThreshold) && <span>*</span>}</Label>\n          <TextArea placeholder={i18n('REVIEW_CONTENT')} value={review_content} name=\"review_content\" onInput={this.handleChange} required={(rating != 0 && !isAboveThreshold)}/>\n          <Error error={error} title=\"Message is Required\" />\n        </InputGroup>\n        <InputGroup error={error} errors={['Name is Required']}>\n          <Label for=\"author_name\">{i18n('Name')}{(rating != 0 && !isAboveThreshold) && <span>*</span>}</Label>\n          <Input placeholder={i18n('Name')} value={author_name} name=\"author_name\" onInput={this.handleChange} required={(rating != 0 && !isAboveThreshold)} />\n          <Error error={error} title=\"Name is Required\" />\n        </InputGroup>\n        <InputGroup error={error} errors={['Email is Invalid', 'Email is Required']}>\n          <Label for=\"author_email\">{i18n('Email')}{(rating != 0 && !isAboveThreshold) && <span>*</span>}</Label>\n          <Input placeholder={i18n('Email')} type=\"email\" value={author_email} name=\"author_email\" onInput={this.handleChange} required={(rating != 0 && !isAboveThreshold)} />\n          <Error error={error} title=\"Email is Invalid\" />\n          <Error error={error} title=\"Email is Required\" />\n        </InputGroup>\n        <Button\n          type=\"submit\"\n          disabled={this.getFormValidationStatus() || status === SUBMITTING}\n        >\n          {status === SUBMITTING\n            ? i18n('Submitting')\n            : i18n(this.fromInitial ? 'Update Review' : 'Submit Review')}\n        </Button>\n\n        <footer>\n          {i18n('CONSENT') /* GDPR consent */}\n        </footer>\n      </form>\n    )\n  }\n}\n\nexport default Form\n","function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return (module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports), _typeof(obj);\n}\n\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var setPrototypeOf = require(\"./setPrototypeOf.js\");\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}\n\nmodule.exports = _inherits, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","/* eslint camelcase: 0 */\nimport { Component } from 'preact'\nimport { createPortal } from 'preact/compat'\nimport { getInitialState } from '../../helpers/state'\nimport { Stars, ReviewForm, Modal } from '../'\nimport i18n from '../../i18n'\nimport {\n  PROMPT_THRESHOLD,\n  OPEN,\n  CLOSED,\n  PENDING,\n  ERROR,\n  AUTOSUBMIT_THESHOLD,\n  AGGRESSIVE_CTA\n} from '../constants'\nimport { submit } from '../helpers';\nimport CTA from './CTA'\n\nexport const CLASS = 'mv-reviews'\n\n/**\n * Renders the rating UI in cards.\n */\nclass Ratings extends Component {\n  constructor(props) {\n    super(props)\n\n    this.initialData = getInitialState(props.id)\n\n    this.state = {\n      localRating: this.initialData ? this.initialData.rating : null,\n      status: CLOSED,\n    }\n\n    this.handleClick = this.handleClick.bind(this)\n    this.handleUpdateRatings = this.handleUpdateRatings.bind(this)\n    this.renderInner = this.renderInner.bind(this)\n    this.renderModal = this.renderModal.bind(this)\n  }\n\n  componentDidMount() {\n    // All of this code only needs to execute if we're\n    // displaying aggressive CTAs.\n    if(!AGGRESSIVE_CTA) return\n\n    // Append target div to after notes, or ingredients if notes doesn't exist\n    const cardWrap = this.props.el.closest('.mv-create-wrapper')\n    const insertAfter =\n      cardWrap.querySelector('.mv-create-notes') ||\n      cardWrap.querySelector('.mv-create-instructions')\n    this.target = document.createElement('div')\n    cardWrap.appendChild(this.target)\n    cardWrap.insertBefore(this.target, insertAfter.nextSibling)\n  }\n\n  /**\n   * Callback to handle a star selection. Modal opens if below threshold (default 5.5 aka always)\n   * @param {number} localRating\n   */\n  async handleClick(rating) {\n    const { id } = this.props\n\n    if(rating >= AUTOSUBMIT_THESHOLD) {\n      const submitData = { creation: id, rating }\n      if (this.initialData?.handshake) {\n        submitData.handshake = this.initialData.handshake\n      }\n      const res = await submit(submitData)\n      if(!res.ok) {\n        this.setState({ status: ERROR })\n        return\n      }\n    }\n\n    if(rating >= PROMPT_THRESHOLD) {\n      this.setState({ status: PENDING, localRating: rating })\n    } else {\n      this.setState({ status: OPEN, localRating: rating })\n    }\n  }\n\n  /**\n   * Callback after form submission. We close the modal and update ratings.\n   * @param {number} rating    New rating\n   * @param {object} previous  Locally-cached rating\n   */\n  handleUpdateRatings(review) {\n    this.setState({ status: CLOSED })\n    if (this.initialData) {\n      const { id, onUpdate } = this.props\n      onUpdate(id, review)\n    } else {\n      const { id, onAdd } = this.props\n      onAdd(id, review)\n    }\n  }\n\n  renderInner() {\n    const { localRating } = this.state\n    const { rating } = this.props\n\n    return (\n      <div>\n        <Stars\n          rating={localRating}\n          globalRating={rating}\n          onClick={this.handleClick}\n        />\n      </div>\n    )\n  }\n\n  renderModal() {\n    const { localRating } = this.state\n    const { id } = this.props\n    return (\n      <Modal onClose={() => this.setState({ status: CLOSED })}>\n        <ReviewForm\n          id={id}\n          initial={this.initialData}\n          rating={localRating}\n          onSubmit={this.handleUpdateRatings}\n        />\n      </Modal>\n    )\n  }\n\n  render() {\n    const { status } = this.state\n    const { total, rating } = this.props\n\n    if(this.cardThemeSupportsTopLevelCTA) {\n      return (\n        <div>\n          <CTA onClick={() => this.setState({ status: OPEN })}>\n            {this.renderInner()}\n          </CTA>\n\n          {status === OPEN && (\n            this.renderModal()\n          )}\n        </div>\n      )\n    }\n\n    return (\n      <div class={`${CLASS}`}>\n\n        {this.renderInner()}\n\n        <div class={`${CLASS}-reviewcount`}>\n          {/* If we have reviews, render the counts. If not, fallback to \"no ratings\" message. */}\n          {Number(total) ? (\n            <span>\n              {i18n('NUM_STARS')(parseFloat(rating).toFixed(1))}\n              {' ('}\n              {total > 1 ? i18n('NUM_REVIEWS')(total) : i18n('NUM_REVIEW')(total)}\n              {')'}\n            </span>\n          ) : i18n('NO_RATINGS')}\n        </div>\n\n        {status === ERROR && (\n          <div>{i18n('GENERIC_ERROR')}</div>\n        )}\n\n        {status === PENDING && (\n          <button onClick={() => this.setState({ status: OPEN })}>\n            {i18n('THANKS_RATING')} {i18n('LEAVE_REVIEW')}\n          </button>\n        )}\n\n        {status === OPEN && (\n          this.renderModal()\n        )}\n\n        {this.target && !this.initialData && (\n          // Render the in-card CTA only if there wasn't initial data for the card\n            createPortal(\n              <CTA onClick={() => this.setState({ status: OPEN })}>\n              {this.renderInner()}\n              </CTA>,\n              this.target\n            )\n\n        )}\n\n      </div>\n\n    )\n  }\n}\n\nexport default Ratings\n","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","const KEY = 'mv_state'\n\n/**\n * Returns full value of MV Store\n * @return {object}\n */\nexport const getLocalState = () => {\n  try {\n    return JSON.parse(localStorage.getItem(KEY))\n  } catch (err) {\n    return null\n  }\n}\n\n/**\n * Caches review data\n * @param {object} data Object where keys are review IDs and values are review data\n * Like:\n * {\n *   1: { ...attributes }\n * }\n * @return {object} Value of the first object passed\n */\nexport const setLocalState = (data) => {\n  const state = getLocalState() || { ratings: {} }\n  const { ratings } = state\n  const updatedRatings = { ...ratings, ...data }\n  localStorage.setItem(KEY, JSON.stringify({\n    ...state,\n    ratings: updatedRatings,\n  }))\n  return Object.values(data)[0]\n}\n\n/**\n * Given recipe id, get matching review from state\n * @param  {int|string} id Recipe ID\n * @return {object}\n */\nexport const getInitialState = (id) => {\n  const state = getLocalState()\n\n  // If we don't have state or don't have ratings, return null\n  if (!state || !state.ratings) {\n    return null\n  }\n\n  // Get values of previous ratings\n  const ratings = Object.values(state.ratings)\n\n  // Get the rating that matches the id that we passed\n  const rating = ratings.find(({ creation }) => creation == id) // eslint-disable-line\n\n  // Only use the rating data if it has an active handshake\n  if (rating && rating.handshake && rating.handshake.trim() !== \"\") {\n    return rating\n  }\n\n  return null\n}\n","const pattern = /%(?:\\d\\$)?s/\n\n/**\n * Given a string, return a curried function that accepts a variadic set of strings\n * @param  {string}              string   String to be replaced\n * @return {function<...string, ...node>} Function accepting strings or react nodes\n */\nconst makeSprintf = string => (...glue) => {\n  if (glue.every(s => typeof s === 'string')) {\n    return glue.reduce((str, replacement) => str.replace(pattern, replacement), string)\n  }\n  return string.split(pattern).reduce((all, child, index) => (\n    <span>\n      {all}\n      {child}\n      {glue[index] || null}\n    </span>\n  ), null)\n}\n\n// If we're testing, we can stub this function out.\n// Otherwise, we access a key on the __I18N__ global via passed string.\nconst I18n = (str) => {\n  const result = window.MV_CREATE_I18N[str.toUpperCase().replace(' ', '_')]\n  if (!result) {\n    if (process.env.NODE_ENV !== 'production') {\n      console.warn(`No i18n provided for: ${str}`) // eslint-disable-line\n    }\n    return () => ''\n  }\n  return result.match(pattern) ? makeSprintf(result) : result\n}\nconst mockI18n = str => str\nconst __ = (process.env.NODE_ENV !== 'test') ? I18n : mockI18n // eslint-disable-line\n\nexport default __\n","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import {\r\n\tcreateElement,\r\n\trender as preactRender,\r\n\tcloneElement as preactCloneElement,\r\n\tcreateRef,\r\n\tComponent,\r\n\tcreateContext,\r\n\tFragment\r\n} from 'preact';\r\nimport {\r\n\tuseState,\r\n\tuseReducer,\r\n\tuseEffect,\r\n\tuseLayoutEffect,\r\n\tuseRef,\r\n\tuseImperativeHandle,\r\n\tuseMemo,\r\n\tuseCallback,\r\n\tuseContext,\r\n\tuseDebugValue\r\n} from 'preact/hooks';\r\nimport { PureComponent } from './PureComponent';\r\nimport { memo } from './memo';\r\nimport { forwardRef } from './forwardRef';\r\nimport { Children } from './Children';\r\nimport { Suspense, lazy } from './suspense';\r\nimport { SuspenseList } from './suspense-list';\r\nimport { createPortal } from './portals';\r\nimport {\r\n\thydrate,\r\n\trender,\r\n\tREACT_ELEMENT_TYPE,\r\n\t__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED\r\n} from './render';\r\n\r\nconst version = '17.0.2'; // trick libraries to think we are react\r\n\r\n/**\r\n * Legacy version of createElement.\r\n * @param {import('./internal').VNode[\"type\"]} type The node name or Component constructor\r\n */\r\nfunction createFactory(type) {\r\n\treturn createElement.bind(null, type);\r\n}\r\n\r\n/**\r\n * Check if the passed element is a valid (p)react node.\r\n * @param {*} element The element to check\r\n * @returns {boolean}\r\n */\r\nfunction isValidElement(element) {\r\n\treturn !!element && element.$$typeof === REACT_ELEMENT_TYPE;\r\n}\r\n\r\n/**\r\n * Wrap `cloneElement` to abort if the passed element is not a valid element and apply\r\n * all vnode normalizations.\r\n * @param {import('./internal').VNode} element The vnode to clone\r\n * @param {object} props Props to add when cloning\r\n * @param {Array<import('./internal').ComponentChildren>} rest Optional component children\r\n */\r\nfunction cloneElement(element) {\r\n\tif (!isValidElement(element)) return element;\r\n\treturn preactCloneElement.apply(null, arguments);\r\n}\r\n\r\n/**\r\n * Remove a component tree from the DOM, including state and event handlers.\r\n * @param {import('./internal').PreactElement} container\r\n * @returns {boolean}\r\n */\r\nfunction unmountComponentAtNode(container) {\r\n\tif (container._children) {\r\n\t\tpreactRender(null, container);\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n/**\r\n * Get the matching DOM node for a component\r\n * @param {import('./internal').Component} component\r\n * @returns {import('./internal').PreactElement | null}\r\n */\r\nfunction findDOMNode(component) {\r\n\treturn (\r\n\t\t(component &&\r\n\t\t\t(component.base || (component.nodeType === 1 && component))) ||\r\n\t\tnull\r\n\t);\r\n}\r\n\r\n/**\r\n * Deprecated way to control batched rendering inside the reconciler, but we\r\n * already schedule in batches inside our rendering code\r\n * @template Arg\r\n * @param {(arg: Arg) => void} callback function that triggers the updated\r\n * @param {Arg} [arg] Optional argument that can be passed to the callback\r\n */\r\n// eslint-disable-next-line camelcase\r\nconst unstable_batchedUpdates = (callback, arg) => callback(arg);\r\n\r\n/**\r\n * In React, `flushSync` flushes the entire tree and forces a rerender. It's\r\n * implmented here as a no-op.\r\n * @template Arg\r\n * @template Result\r\n * @param {(arg: Arg) => Result} callback function that runs before the flush\r\n * @param {Arg} [arg] Optional arugment that can be passed to the callback\r\n * @returns\r\n */\r\nconst flushSync = (callback, arg) => callback(arg);\r\n\r\n/**\r\n * Strict Mode is not implemented in Preact, so we provide a stand-in for it\r\n * that just renders its children without imposing any restrictions.\r\n */\r\nconst StrictMode = Fragment;\r\n\r\nexport * from 'preact/hooks';\r\nexport {\r\n\tversion,\r\n\tChildren,\r\n\trender,\r\n\thydrate,\r\n\tunmountComponentAtNode,\r\n\tcreatePortal,\r\n\tcreateElement,\r\n\tcreateContext,\r\n\tcreateFactory,\r\n\tcloneElement,\r\n\tcreateRef,\r\n\tFragment,\r\n\tisValidElement,\r\n\tfindDOMNode,\r\n\tComponent,\r\n\tPureComponent,\r\n\tmemo,\r\n\tforwardRef,\r\n\tflushSync,\r\n\t// eslint-disable-next-line camelcase\r\n\tunstable_batchedUpdates,\r\n\tStrictMode,\r\n\tSuspense,\r\n\tSuspenseList,\r\n\tlazy,\r\n\t__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED\r\n};\r\n\r\n// React copies the named exports to the default one.\r\nexport default {\r\n\tuseState,\r\n\tuseReducer,\r\n\tuseEffect,\r\n\tuseLayoutEffect,\r\n\tuseRef,\r\n\tuseImperativeHandle,\r\n\tuseMemo,\r\n\tuseCallback,\r\n\tuseContext,\r\n\tuseDebugValue,\r\n\tversion,\r\n\tChildren,\r\n\trender,\r\n\thydrate,\r\n\tunmountComponentAtNode,\r\n\tcreatePortal,\r\n\tcreateElement,\r\n\tcreateContext,\r\n\tcreateFactory,\r\n\tcloneElement,\r\n\tcreateRef,\r\n\tFragment,\r\n\tisValidElement,\r\n\tfindDOMNode,\r\n\tComponent,\r\n\tPureComponent,\r\n\tmemo,\r\n\tforwardRef,\r\n\tflushSync,\r\n\tunstable_batchedUpdates,\r\n\tStrictMode,\r\n\tSuspense,\r\n\tSuspenseList,\r\n\tlazy,\r\n\t__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED\r\n};\r\n","/**\r\n * Assign properties from `props` to `obj`\r\n * @template O, P The obj and props types\r\n * @param {O} obj The object to copy properties to\r\n * @param {P} props The object to copy properties from\r\n * @returns {O & P}\r\n */\r\nexport function assign(obj, props) {\r\n\tfor (let i in props) obj[i] = props[i];\r\n\treturn /** @type {O & P} */ (obj);\r\n}\r\n\r\n/**\r\n * Check if two objects have a different shape\r\n * @param {object} a\r\n * @param {object} b\r\n * @returns {boolean}\r\n */\r\nexport function shallowDiffers(a, b) {\r\n\tfor (let i in a) if (i !== '__source' && !(i in b)) return true;\r\n\tfor (let i in b) if (i !== '__source' && a[i] !== b[i]) return true;\r\n\treturn false;\r\n}\r\n\r\nexport function removeNode(node) {\r\n\tlet parentNode = node.parentNode;\r\n\tif (parentNode) parentNode.removeChild(node);\r\n}\r\n","import { Component } from 'preact';\r\nimport { shallowDiffers } from './util';\r\n\r\n/**\r\n * Component class with a predefined `shouldComponentUpdate` implementation\r\n */\r\nexport function PureComponent(p) {\r\n\tthis.props = p;\r\n}\r\nPureComponent.prototype = new Component();\r\n// Some third-party libraries check if this property is present\r\nPureComponent.prototype.isPureReactComponent = true;\r\nPureComponent.prototype.shouldComponentUpdate = function(props, state) {\r\n\treturn shallowDiffers(this.props, props) || shallowDiffers(this.state, state);\r\n};\r\n","import { Component, createElement, options, Fragment } from 'preact';\r\nimport { assign } from './util';\r\n\r\nconst oldCatchError = options._catchError;\r\noptions._catchError = function(error, newVNode, oldVNode) {\r\n\tif (error.then) {\r\n\t\t/** @type {import('./internal').Component} */\r\n\t\tlet component;\r\n\t\tlet vnode = newVNode;\r\n\r\n\t\tfor (; (vnode = vnode._parent); ) {\r\n\t\t\tif ((component = vnode._component) && component._childDidSuspend) {\r\n\t\t\t\tif (newVNode._dom == null) {\r\n\t\t\t\t\tnewVNode._dom = oldVNode._dom;\r\n\t\t\t\t\tnewVNode._children = oldVNode._children;\r\n\t\t\t\t}\r\n\t\t\t\t// Don't call oldCatchError if we found a Suspense\r\n\t\t\t\treturn component._childDidSuspend(error, newVNode);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\toldCatchError(error, newVNode, oldVNode);\r\n};\r\n\r\nconst oldUnmount = options.unmount;\r\noptions.unmount = function(vnode) {\r\n\t/** @type {import('./internal').Component} */\r\n\tconst component = vnode._component;\r\n\tif (component && component._onResolve) {\r\n\t\tcomponent._onResolve();\r\n\t}\r\n\r\n\t// if the component is still hydrating\r\n\t// most likely it is because the component is suspended\r\n\t// we set the vnode.type as `null` so that it is not a typeof function\r\n\t// so the unmount will remove the vnode._dom\r\n\tif (component && vnode._hydrating === true) {\r\n\t\tvnode.type = null;\r\n\t}\r\n\r\n\tif (oldUnmount) oldUnmount(vnode);\r\n};\r\n\r\nfunction detachedClone(vnode, detachedParent, parentDom) {\r\n\tif (vnode) {\r\n\t\tif (vnode._component && vnode._component.__hooks) {\r\n\t\t\tvnode._component.__hooks._list.forEach(effect => {\r\n\t\t\t\tif (typeof effect._cleanup == 'function') effect._cleanup();\r\n\t\t\t});\r\n\r\n\t\t\tvnode._component.__hooks = null;\r\n\t\t}\r\n\r\n\t\tvnode = assign({}, vnode);\r\n\t\tif (vnode._component != null) {\r\n\t\t\tif (vnode._component._parentDom === parentDom) {\r\n\t\t\t\tvnode._component._parentDom = detachedParent;\r\n\t\t\t}\r\n\t\t\tvnode._component = null;\r\n\t\t}\r\n\r\n\t\tvnode._children =\r\n\t\t\tvnode._children &&\r\n\t\t\tvnode._children.map(child =>\r\n\t\t\t\tdetachedClone(child, detachedParent, parentDom)\r\n\t\t\t);\r\n\t}\r\n\r\n\treturn vnode;\r\n}\r\n\r\nfunction removeOriginal(vnode, detachedParent, originalParent) {\r\n\tif (vnode) {\r\n\t\tvnode._original = null;\r\n\t\tvnode._children =\r\n\t\t\tvnode._children &&\r\n\t\t\tvnode._children.map(child =>\r\n\t\t\t\tremoveOriginal(child, detachedParent, originalParent)\r\n\t\t\t);\r\n\r\n\t\tif (vnode._component) {\r\n\t\t\tif (vnode._component._parentDom === detachedParent) {\r\n\t\t\t\tif (vnode._dom) {\r\n\t\t\t\t\toriginalParent.insertBefore(vnode._dom, vnode._nextDom);\r\n\t\t\t\t}\r\n\t\t\t\tvnode._component._force = true;\r\n\t\t\t\tvnode._component._parentDom = originalParent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn vnode;\r\n}\r\n\r\n// having custom inheritance instead of a class here saves a lot of bytes\r\nexport function Suspense() {\r\n\t// we do not call super here to golf some bytes...\r\n\tthis._pendingSuspensionCount = 0;\r\n\tthis._suspenders = null;\r\n\tthis._detachOnNextRender = null;\r\n}\r\n\r\n// Things we do here to save some bytes but are not proper JS inheritance:\r\n// - call `new Component()` as the prototype\r\n// - do not set `Suspense.prototype.constructor` to `Suspense`\r\nSuspense.prototype = new Component();\r\n\r\n/**\r\n * @this {import('./internal').SuspenseComponent}\r\n * @param {Promise} promise The thrown promise\r\n * @param {import('./internal').VNode<any, any>} suspendingVNode The suspending component\r\n */\r\nSuspense.prototype._childDidSuspend = function(promise, suspendingVNode) {\r\n\tconst suspendingComponent = suspendingVNode._component;\r\n\r\n\t/** @type {import('./internal').SuspenseComponent} */\r\n\tconst c = this;\r\n\r\n\tif (c._suspenders == null) {\r\n\t\tc._suspenders = [];\r\n\t}\r\n\tc._suspenders.push(suspendingComponent);\r\n\r\n\tconst resolve = suspended(c._vnode);\r\n\r\n\tlet resolved = false;\r\n\tconst onResolved = () => {\r\n\t\tif (resolved) return;\r\n\r\n\t\tresolved = true;\r\n\t\tsuspendingComponent._onResolve = null;\r\n\r\n\t\tif (resolve) {\r\n\t\t\tresolve(onSuspensionComplete);\r\n\t\t} else {\r\n\t\t\tonSuspensionComplete();\r\n\t\t}\r\n\t};\r\n\r\n\tsuspendingComponent._onResolve = onResolved;\r\n\r\n\tconst onSuspensionComplete = () => {\r\n\t\tif (!--c._pendingSuspensionCount) {\r\n\t\t\t// If the suspension was during hydration we don't need to restore the\r\n\t\t\t// suspended children into the _children array\r\n\t\t\tif (c.state._suspended) {\r\n\t\t\t\tconst suspendedVNode = c.state._suspended;\r\n\t\t\t\tc._vnode._children[0] = removeOriginal(\r\n\t\t\t\t\tsuspendedVNode,\r\n\t\t\t\t\tsuspendedVNode._component._parentDom,\r\n\t\t\t\t\tsuspendedVNode._component._originalParentDom\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tc.setState({ _suspended: (c._detachOnNextRender = null) });\r\n\r\n\t\t\tlet suspended;\r\n\t\t\twhile ((suspended = c._suspenders.pop())) {\r\n\t\t\t\tsuspended.forceUpdate();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * We do not set `suspended: true` during hydration because we want the actual markup\r\n\t * to remain on screen and hydrate it when the suspense actually gets resolved.\r\n\t * While in non-hydration cases the usual fallback -> component flow would occour.\r\n\t */\r\n\tconst wasHydrating = suspendingVNode._hydrating === true;\r\n\tif (!c._pendingSuspensionCount++ && !wasHydrating) {\r\n\t\tc.setState({ _suspended: (c._detachOnNextRender = c._vnode._children[0]) });\r\n\t}\r\n\tpromise.then(onResolved, onResolved);\r\n};\r\n\r\nSuspense.prototype.componentWillUnmount = function() {\r\n\tthis._suspenders = [];\r\n};\r\n\r\n/**\r\n * @this {import('./internal').SuspenseComponent}\r\n * @param {import('./internal').SuspenseComponent[\"props\"]} props\r\n * @param {import('./internal').SuspenseState} state\r\n */\r\nSuspense.prototype.render = function(props, state) {\r\n\tif (this._detachOnNextRender) {\r\n\t\t// When the Suspense's _vnode was created by a call to createVNode\r\n\t\t// (i.e. due to a setState further up in the tree)\r\n\t\t// it's _children prop is null, in this case we \"forget\" about the parked vnodes to detach\r\n\t\tif (this._vnode._children) {\r\n\t\t\tconst detachedParent = document.createElement('div');\r\n\t\t\tconst detachedComponent = this._vnode._children[0]._component;\r\n\t\t\tthis._vnode._children[0] = detachedClone(\r\n\t\t\t\tthis._detachOnNextRender,\r\n\t\t\t\tdetachedParent,\r\n\t\t\t\t(detachedComponent._originalParentDom = detachedComponent._parentDom)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis._detachOnNextRender = null;\r\n\t}\r\n\r\n\t// Wrap fallback tree in a VNode that prevents itself from being marked as aborting mid-hydration:\r\n\t/** @type {import('./internal').VNode} */\r\n\tconst fallback =\r\n\t\tstate._suspended && createElement(Fragment, null, props.fallback);\r\n\tif (fallback) fallback._hydrating = null;\r\n\r\n\treturn [\r\n\t\tcreateElement(Fragment, null, state._suspended ? null : props.children),\r\n\t\tfallback\r\n\t];\r\n};\r\n\r\n/**\r\n * Checks and calls the parent component's _suspended method, passing in the\r\n * suspended vnode. This is a way for a parent (e.g. SuspenseList) to get notified\r\n * that one of its children/descendants suspended.\r\n *\r\n * The parent MAY return a callback. The callback will get called when the\r\n * suspension resolves, notifying the parent of the fact.\r\n * Moreover, the callback gets function `unsuspend` as a parameter. The resolved\r\n * child descendant will not actually get unsuspended until `unsuspend` gets called.\r\n * This is a way for the parent to delay unsuspending.\r\n *\r\n * If the parent does not return a callback then the resolved vnode\r\n * gets unsuspended immediately when it resolves.\r\n *\r\n * @param {import('./internal').VNode} vnode\r\n * @returns {((unsuspend: () => void) => void)?}\r\n */\r\nexport function suspended(vnode) {\r\n\t/** @type {import('./internal').Component} */\r\n\tlet component = vnode._parent._component;\r\n\treturn component && component._suspended && component._suspended(vnode);\r\n}\r\n\r\nexport function lazy(loader) {\r\n\tlet prom;\r\n\tlet component;\r\n\tlet error;\r\n\r\n\tfunction Lazy(props) {\r\n\t\tif (!prom) {\r\n\t\t\tprom = loader();\r\n\t\t\tprom.then(\r\n\t\t\t\texports => {\r\n\t\t\t\t\tcomponent = exports.default || exports;\r\n\t\t\t\t},\r\n\t\t\t\te => {\r\n\t\t\t\t\terror = e;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\r\n\t\tif (!component) {\r\n\t\t\tthrow prom;\r\n\t\t}\r\n\r\n\t\treturn createElement(component, props);\r\n\t}\r\n\r\n\tLazy.displayName = 'Lazy';\r\n\tLazy._forwarded = true;\r\n\treturn Lazy;\r\n}\r\n","import { Component, toChildArray } from 'preact';\r\nimport { suspended } from './suspense.js';\r\n\r\n// Indexes to linked list nodes (nodes are stored as arrays to save bytes).\r\nconst SUSPENDED_COUNT = 0;\r\nconst RESOLVED_COUNT = 1;\r\nconst NEXT_NODE = 2;\r\n\r\n// Having custom inheritance instead of a class here saves a lot of bytes.\r\nexport function SuspenseList() {\r\n\tthis._next = null;\r\n\tthis._map = null;\r\n}\r\n\r\n// Mark one of child's earlier suspensions as resolved.\r\n// Some pending callbacks may become callable due to this\r\n// (e.g. the last suspended descendant gets resolved when\r\n// revealOrder === 'together'). Process those callbacks as well.\r\nconst resolve = (list, child, node) => {\r\n\tif (++node[RESOLVED_COUNT] === node[SUSPENDED_COUNT]) {\r\n\t\t// The number a child (or any of its descendants) has been suspended\r\n\t\t// matches the number of times it's been resolved. Therefore we\r\n\t\t// mark the child as completely resolved by deleting it from ._map.\r\n\t\t// This is used to figure out when *all* children have been completely\r\n\t\t// resolved when revealOrder is 'together'.\r\n\t\tlist._map.delete(child);\r\n\t}\r\n\r\n\t// If revealOrder is falsy then we can do an early exit, as the\r\n\t// callbacks won't get queued in the node anyway.\r\n\t// If revealOrder is 'together' then also do an early exit\r\n\t// if all suspended descendants have not yet been resolved.\r\n\tif (\r\n\t\t!list.props.revealOrder ||\r\n\t\t(list.props.revealOrder[0] === 't' && list._map.size)\r\n\t) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t// Walk the currently suspended children in order, calling their\r\n\t// stored callbacks on the way. Stop if we encounter a child that\r\n\t// has not been completely resolved yet.\r\n\tnode = list._next;\r\n\twhile (node) {\r\n\t\twhile (node.length > 3) {\r\n\t\t\tnode.pop()();\r\n\t\t}\r\n\t\tif (node[RESOLVED_COUNT] < node[SUSPENDED_COUNT]) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tlist._next = node = node[NEXT_NODE];\r\n\t}\r\n};\r\n\r\n// Things we do here to save some bytes but are not proper JS inheritance:\r\n// - call `new Component()` as the prototype\r\n// - do not set `Suspense.prototype.constructor` to `Suspense`\r\nSuspenseList.prototype = new Component();\r\n\r\nSuspenseList.prototype._suspended = function(child) {\r\n\tconst list = this;\r\n\tconst delegated = suspended(list._vnode);\r\n\r\n\tlet node = list._map.get(child);\r\n\tnode[SUSPENDED_COUNT]++;\r\n\r\n\treturn unsuspend => {\r\n\t\tconst wrappedUnsuspend = () => {\r\n\t\t\tif (!list.props.revealOrder) {\r\n\t\t\t\t// Special case the undefined (falsy) revealOrder, as there\r\n\t\t\t\t// is no need to coordinate a specific order or unsuspends.\r\n\t\t\t\tunsuspend();\r\n\t\t\t} else {\r\n\t\t\t\tnode.push(unsuspend);\r\n\t\t\t\tresolve(list, child, node);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (delegated) {\r\n\t\t\tdelegated(wrappedUnsuspend);\r\n\t\t} else {\r\n\t\t\twrappedUnsuspend();\r\n\t\t}\r\n\t};\r\n};\r\n\r\nSuspenseList.prototype.render = function(props) {\r\n\tthis._next = null;\r\n\tthis._map = new Map();\r\n\r\n\tconst children = toChildArray(props.children);\r\n\tif (props.revealOrder && props.revealOrder[0] === 'b') {\r\n\t\t// If order === 'backwards' (or, well, anything starting with a 'b')\r\n\t\t// then flip the child list around so that the last child will be\r\n\t\t// the first in the linked list.\r\n\t\tchildren.reverse();\r\n\t}\r\n\t// Build the linked list. Iterate through the children in reverse order\r\n\t// so that `_next` points to the first linked list node to be resolved.\r\n\tfor (let i = children.length; i--; ) {\r\n\t\t// Create a new linked list node as an array of form:\r\n\t\t// \t[suspended_count, resolved_count, next_node]\r\n\t\t// where suspended_count and resolved_count are numeric counters for\r\n\t\t// keeping track how many times a node has been suspended and resolved.\r\n\t\t//\r\n\t\t// Note that suspended_count starts from 1 instead of 0, so we can block\r\n\t\t// processing callbacks until componentDidMount has been called. In a sense\r\n\t\t// node is suspended at least until componentDidMount gets called!\r\n\t\t//\r\n\t\t// Pending callbacks are added to the end of the node:\r\n\t\t// \t[suspended_count, resolved_count, next_node, callback_0, callback_1, ...]\r\n\t\tthis._map.set(children[i], (this._next = [1, 0, this._next]));\r\n\t}\r\n\treturn props.children;\r\n};\r\n\r\nSuspenseList.prototype.componentDidUpdate = SuspenseList.prototype.componentDidMount = function() {\r\n\t// Iterate through all children after mounting for two reasons:\r\n\t// 1. As each node[SUSPENDED_COUNT] starts from 1, this iteration increases\r\n\t//    each node[RELEASED_COUNT] by 1, therefore balancing the counters.\r\n\t//    The nodes can now be completely consumed from the linked list.\r\n\t// 2. Handle nodes that might have gotten resolved between render and\r\n\t//    componentDidMount.\r\n\tthis._map.forEach((node, child) => {\r\n\t\tresolve(this, child, node);\r\n\t});\r\n};\r\n","import { createElement, render } from 'preact';\r\n\r\n/**\r\n * @param {import('../../src/index').RenderableProps<{ context: any }>} props\r\n */\r\nfunction ContextProvider(props) {\r\n\tthis.getChildContext = () => props.context;\r\n\treturn props.children;\r\n}\r\n\r\n/**\r\n * Portal component\r\n * @this {import('./internal').Component}\r\n * @param {object | null | undefined} props\r\n *\r\n * TODO: use createRoot() instead of fake root\r\n */\r\nfunction Portal(props) {\r\n\tconst _this = this;\r\n\tlet container = props._container;\r\n\r\n\t_this.componentWillUnmount = function() {\r\n\t\trender(null, _this._temp);\r\n\t\t_this._temp = null;\r\n\t\t_this._container = null;\r\n\t};\r\n\r\n\t// When we change container we should clear our old container and\r\n\t// indicate a new mount.\r\n\tif (_this._container && _this._container !== container) {\r\n\t\t_this.componentWillUnmount();\r\n\t}\r\n\r\n\t// When props.vnode is undefined/false/null we are dealing with some kind of\r\n\t// conditional vnode. This should not trigger a render.\r\n\tif (props._vnode) {\r\n\t\tif (!_this._temp) {\r\n\t\t\t_this._container = container;\r\n\r\n\t\t\t// Create a fake DOM parent node that manages a subset of `container`'s children:\r\n\t\t\t_this._temp = {\r\n\t\t\t\tnodeType: 1,\r\n\t\t\t\tparentNode: container,\r\n\t\t\t\tchildNodes: [],\r\n\t\t\t\tappendChild(child) {\r\n\t\t\t\t\tthis.childNodes.push(child);\r\n\t\t\t\t\t_this._container.appendChild(child);\r\n\t\t\t\t},\r\n\t\t\t\tinsertBefore(child, before) {\r\n\t\t\t\t\tthis.childNodes.push(child);\r\n\t\t\t\t\t_this._container.appendChild(child);\r\n\t\t\t\t},\r\n\t\t\t\tremoveChild(child) {\r\n\t\t\t\t\tthis.childNodes.splice(this.childNodes.indexOf(child) >>> 1, 1);\r\n\t\t\t\t\t_this._container.removeChild(child);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Render our wrapping element into temp.\r\n\t\trender(\r\n\t\t\tcreateElement(ContextProvider, { context: _this.context }, props._vnode),\r\n\t\t\t_this._temp\r\n\t\t);\r\n\t}\r\n\t// When we come from a conditional render, on a mounted\r\n\t// portal we should clear the DOM.\r\n\telse if (_this._temp) {\r\n\t\t_this.componentWillUnmount();\r\n\t}\r\n}\r\n\r\n/**\r\n * Create a `Portal` to continue rendering the vnode tree at a different DOM node\r\n * @param {import('./internal').VNode} vnode The vnode to render\r\n * @param {import('./internal').PreactElement} container The DOM node to continue rendering in to.\r\n */\r\nexport function createPortal(vnode, container) {\r\n\treturn createElement(Portal, { _vnode: vnode, _container: container });\r\n}\r\n","import {\r\n\trender as preactRender,\r\n\thydrate as preactHydrate,\r\n\toptions,\r\n\ttoChildArray,\r\n\tComponent\r\n} from 'preact';\r\n\r\nexport const REACT_ELEMENT_TYPE =\r\n\t(typeof Symbol != 'undefined' && Symbol.for && Symbol.for('react.element')) ||\r\n\t0xeac7;\r\n\r\nconst CAMEL_PROPS = /^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|marker(?!H|W|U)|overline|paint|stop|strikethrough|stroke|text(?!L)|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/;\r\n\r\nconst IS_DOM = typeof document !== 'undefined';\r\n\r\n// Input types for which onchange should not be converted to oninput.\r\n// type=\"file|checkbox|radio\", plus \"range\" in IE11.\r\n// (IE11 doesn't support Symbol, which we use here to turn `rad` into `ra` which matches \"range\")\r\nconst onChangeInputType = type =>\r\n\t(typeof Symbol != 'undefined' && typeof Symbol() == 'symbol'\r\n\t\t? /fil|che|rad/i\r\n\t\t: /fil|che|ra/i\r\n\t).test(type);\r\n\r\n// Some libraries like `react-virtualized` explicitly check for this.\r\nComponent.prototype.isReactComponent = {};\r\n\r\n// `UNSAFE_*` lifecycle hooks\r\n// Preact only ever invokes the unprefixed methods.\r\n// Here we provide a base \"fallback\" implementation that calls any defined UNSAFE_ prefixed method.\r\n// - If a component defines its own `componentDidMount()` (including via defineProperty), use that.\r\n// - If a component defines `UNSAFE_componentDidMount()`, `componentDidMount` is the alias getter/setter.\r\n// - If anything assigns to an `UNSAFE_*` property, the assignment is forwarded to the unprefixed property.\r\n// See https://github.com/preactjs/preact/issues/1941\r\n[\r\n\t'componentWillMount',\r\n\t'componentWillReceiveProps',\r\n\t'componentWillUpdate'\r\n].forEach(key => {\r\n\tObject.defineProperty(Component.prototype, key, {\r\n\t\tconfigurable: true,\r\n\t\tget() {\r\n\t\t\treturn this['UNSAFE_' + key];\r\n\t\t},\r\n\t\tset(v) {\r\n\t\t\tObject.defineProperty(this, key, {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\twritable: true,\r\n\t\t\t\tvalue: v\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n});\r\n\r\n/**\r\n * Proxy render() since React returns a Component reference.\r\n * @param {import('./internal').VNode} vnode VNode tree to render\r\n * @param {import('./internal').PreactElement} parent DOM node to render vnode tree into\r\n * @param {() => void} [callback] Optional callback that will be called after rendering\r\n * @returns {import('./internal').Component | null} The root component reference or null\r\n */\r\nexport function render(vnode, parent, callback) {\r\n\t// React destroys any existing DOM nodes, see #1727\r\n\t// ...but only on the first render, see #1828\r\n\tif (parent._children == null) {\r\n\t\tparent.textContent = '';\r\n\t}\r\n\r\n\tpreactRender(vnode, parent);\r\n\tif (typeof callback == 'function') callback();\r\n\r\n\treturn vnode ? vnode._component : null;\r\n}\r\n\r\nexport function hydrate(vnode, parent, callback) {\r\n\tpreactHydrate(vnode, parent);\r\n\tif (typeof callback == 'function') callback();\r\n\r\n\treturn vnode ? vnode._component : null;\r\n}\r\n\r\nlet oldEventHook = options.event;\r\noptions.event = e => {\r\n\tif (oldEventHook) e = oldEventHook(e);\r\n\te.persist = empty;\r\n\te.isPropagationStopped = isPropagationStopped;\r\n\te.isDefaultPrevented = isDefaultPrevented;\r\n\treturn (e.nativeEvent = e);\r\n};\r\n\r\nfunction empty() {}\r\n\r\nfunction isPropagationStopped() {\r\n\treturn this.cancelBubble;\r\n}\r\n\r\nfunction isDefaultPrevented() {\r\n\treturn this.defaultPrevented;\r\n}\r\n\r\nlet classNameDescriptor = {\r\n\tconfigurable: true,\r\n\tget() {\r\n\t\treturn this.class;\r\n\t}\r\n};\r\n\r\nlet oldVNodeHook = options.vnode;\r\noptions.vnode = vnode => {\r\n\tlet type = vnode.type;\r\n\tlet props = vnode.props;\r\n\tlet normalizedProps = props;\r\n\r\n\t// only normalize props on Element nodes\r\n\tif (typeof type === 'string') {\r\n\t\tconst nonCustomElement = type.indexOf('-') === -1;\r\n\t\tnormalizedProps = {};\r\n\r\n\t\tfor (let i in props) {\r\n\t\t\tlet value = props[i];\r\n\r\n\t\t\tif (IS_DOM && i === 'children' && type === 'noscript') {\r\n\t\t\t\t// Emulate React's behavior of not rendering the contents of noscript tags on the client.\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\telse if (i === 'value' && 'defaultValue' in props && value == null) {\r\n\t\t\t\t// Skip applying value if it is null/undefined and we already set\r\n\t\t\t\t// a default value\r\n\t\t\t\tcontinue;\r\n\t\t\t} else if (\r\n\t\t\t\ti === 'defaultValue' &&\r\n\t\t\t\t'value' in props &&\r\n\t\t\t\tprops.value == null\r\n\t\t\t) {\r\n\t\t\t\t// `defaultValue` is treated as a fallback `value` when a value prop is present but null/undefined.\r\n\t\t\t\t// `defaultValue` for Elements with no value prop is the same as the DOM defaultValue property.\r\n\t\t\t\ti = 'value';\r\n\t\t\t} else if (i === 'download' && value === true) {\r\n\t\t\t\t// Calling `setAttribute` with a truthy value will lead to it being\r\n\t\t\t\t// passed as a stringified value, e.g. `download=\"true\"`. React\r\n\t\t\t\t// converts it to an empty string instead, otherwise the attribute\r\n\t\t\t\t// value will be used as the file name and the file will be called\r\n\t\t\t\t// \"true\" upon downloading it.\r\n\t\t\t\tvalue = '';\r\n\t\t\t} else if (/ondoubleclick/i.test(i)) {\r\n\t\t\t\ti = 'ondblclick';\r\n\t\t\t} else if (\r\n\t\t\t\t/^onchange(textarea|input)/i.test(i + type) &&\r\n\t\t\t\t!onChangeInputType(props.type)\r\n\t\t\t) {\r\n\t\t\t\ti = 'oninput';\r\n\t\t\t} else if (/^onfocus$/i.test(i)) {\r\n\t\t\t\ti = 'onfocusin';\r\n\t\t\t} else if (/^onblur$/i.test(i)) {\r\n\t\t\t\ti = 'onfocusout';\r\n\t\t\t} else if (/^on(Ani|Tra|Tou|BeforeInp)/.test(i)) {\r\n\t\t\t\ti = i.toLowerCase();\r\n\t\t\t} else if (nonCustomElement && CAMEL_PROPS.test(i)) {\r\n\t\t\t\ti = i.replace(/[A-Z0-9]/, '-$&').toLowerCase();\r\n\t\t\t} else if (value === null) {\r\n\t\t\t\tvalue = undefined;\r\n\t\t\t}\r\n\r\n\t\t\tnormalizedProps[i] = value;\r\n\t\t}\r\n\r\n\t\t// Add support for array select values: <select multiple value={[]} />\r\n\t\tif (\r\n\t\t\ttype == 'select' &&\r\n\t\t\tnormalizedProps.multiple &&\r\n\t\t\tArray.isArray(normalizedProps.value)\r\n\t\t) {\r\n\t\t\t// forEach() always returns undefined, which we abuse here to unset the value prop.\r\n\t\t\tnormalizedProps.value = toChildArray(props.children).forEach(child => {\r\n\t\t\t\tchild.props.selected =\r\n\t\t\t\t\tnormalizedProps.value.indexOf(child.props.value) != -1;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Adding support for defaultValue in select tag\r\n\t\tif (type == 'select' && normalizedProps.defaultValue != null) {\r\n\t\t\tnormalizedProps.value = toChildArray(props.children).forEach(child => {\r\n\t\t\t\tif (normalizedProps.multiple) {\r\n\t\t\t\t\tchild.props.selected =\r\n\t\t\t\t\t\tnormalizedProps.defaultValue.indexOf(child.props.value) != -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchild.props.selected =\r\n\t\t\t\t\t\tnormalizedProps.defaultValue == child.props.value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvnode.props = normalizedProps;\r\n\r\n\t\tif (props.class != props.className) {\r\n\t\t\tclassNameDescriptor.enumerable = 'className' in props;\r\n\t\t\tif (props.className != null) normalizedProps.class = props.className;\r\n\t\t\tObject.defineProperty(normalizedProps, 'className', classNameDescriptor);\r\n\t\t}\r\n\t}\r\n\r\n\tvnode.$$typeof = REACT_ELEMENT_TYPE;\r\n\r\n\tif (oldVNodeHook) oldVNodeHook(vnode);\r\n};\r\n\r\n// Only needed for react-relay\r\nlet currentComponent;\r\nconst oldBeforeRender = options._render;\r\noptions._render = function(vnode) {\r\n\tif (oldBeforeRender) {\r\n\t\toldBeforeRender(vnode);\r\n\t}\r\n\tcurrentComponent = vnode._component;\r\n};\r\n\r\n// This is a very very private internal function for React it\r\n// is used to sort-of do runtime dependency injection. So far\r\n// only `react-relay` makes use of it. It uses it to read the\r\n// context value.\r\nexport const __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED = {\r\n\tReactCurrentDispatcher: {\r\n\t\tcurrent: {\r\n\t\t\treadContext(context) {\r\n\t\t\t\treturn currentComponent._globalContext[context._id].props.value;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n","import { options } from 'preact';\r\nimport { assign } from './util';\r\n\r\nlet oldDiffHook = options._diff;\r\noptions._diff = vnode => {\r\n\tif (vnode.type && vnode.type._forwarded && vnode.ref) {\r\n\t\tvnode.props.ref = vnode.ref;\r\n\t\tvnode.ref = null;\r\n\t}\r\n\tif (oldDiffHook) oldDiffHook(vnode);\r\n};\r\n\r\nexport const REACT_FORWARD_SYMBOL =\r\n\t(typeof Symbol != 'undefined' &&\r\n\t\tSymbol.for &&\r\n\t\tSymbol.for('react.forward_ref')) ||\r\n\t0xf47;\r\n\r\n/**\r\n * Pass ref down to a child. This is mainly used in libraries with HOCs that\r\n * wrap components. Using `forwardRef` there is an easy way to get a reference\r\n * of the wrapped component instead of one of the wrapper itself.\r\n * @param {import('./index').ForwardFn} fn\r\n * @returns {import('./internal').FunctionComponent}\r\n */\r\nexport function forwardRef(fn) {\r\n\t// We always have ref in props.ref, except for\r\n\t// mobx-react. It will call this function directly\r\n\t// and always pass ref as the second argument.\r\n\tfunction Forwarded(props, ref) {\r\n\t\tlet clone = assign({}, props);\r\n\t\tdelete clone.ref;\r\n\t\tref = props.ref || ref;\r\n\t\treturn fn(\r\n\t\t\tclone,\r\n\t\t\t!ref || (typeof ref === 'object' && !('current' in ref)) ? null : ref\r\n\t\t);\r\n\t}\r\n\r\n\t// mobx-react checks for this being present\r\n\tForwarded.$$typeof = REACT_FORWARD_SYMBOL;\r\n\t// mobx-react heavily relies on implementation details.\r\n\t// It expects an object here with a `render` property,\r\n\t// and prototype.render will fail. Without this\r\n\t// mobx-react throws.\r\n\tForwarded.render = Forwarded;\r\n\r\n\tForwarded.prototype.isReactComponent = Forwarded._forwarded = true;\r\n\tForwarded.displayName = 'ForwardRef(' + (fn.displayName || fn.name) + ')';\r\n\treturn Forwarded;\r\n}\r\n"],"sourceRoot":""}